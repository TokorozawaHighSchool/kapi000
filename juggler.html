<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>„Ç¢„Ç§„É†„Ç∏„É£„Ç∞„É©„ÉºÈ¢®„Çπ„É≠„ÉÉ„Éà</title>
  <style>
    :root{--bg:#0b0b0f;--panel:#1e1b29;--accent:#ffde00;--muted:#666}
    body { font-family: 'Yu Gothic', system-ui, sans-serif; text-align: center; background: radial-gradient(ellipse at top, #0b0b0f 0%, #070607 60%), #000; color: #fff; min-height:100vh; margin:0; padding:24px; }
    h1{margin:0 0 8px 0; font-size:28px; letter-spacing:1px}
    .machine{max-width:740px;margin:18px auto;padding:18px;background:linear-gradient(180deg,#0f0f13, #141218);border-radius:12px;border:2px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    .info{display:flex;justify-content:space-between;align-items:center;padding:6px 12px}
    #money{font-weight:700;color:var(--accent)}
    .reels { display: flex; justify-content: center; gap:20px; margin: 18px 0; }
    .reel-stack { display: flex; flex-direction: column; align-items: center; background:linear-gradient(180deg,#151217,#0f0d12);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .reel { font-size:1.6rem; width:92px; height:92px; background:#0b0b0f; margin:4px 0; border-radius:8px; display:flex;align-items:center;justify-content:center;border:3px solid #221f2b;color:#fff;box-shadow:0 4px 18px rgba(0,0,0,0.6) inset}
    .reel.center{font-size:2rem;border-color:var(--accent);color:var(--accent);box-shadow:0 0 18px rgba(255,222,0,0.12), 0 4px 30px rgba(0,0,0,0.8) inset}
    .stop-btn { margin-top: 10px; font-size: 0.95rem; padding: 8px 18px; border-radius: 20px; border: none; background:#333;color:#fff;cursor:pointer}
    .stop-btn:disabled{opacity:0.35;cursor:default}
    .controls{display:flex;gap:12px;justify-content:center;align-items:center;margin-top:8px}
    #gogo{font-size:2.2rem;color:var(--accent);text-shadow:0 0 8px rgba(255,222,0,0.6);display:none}
    #start{font-size:1.05rem;padding:10px 26px;border-radius:24px;border:none;background:linear-gradient(180deg,#ff6b6b,#d9456b);color:#fff;cursor:pointer}
    #start:disabled{opacity:0.5}
    /* „É©„É≥„Éó */
    .lamp-row{display:flex;gap:8px;justify-content:center;margin-top:8px}
    .lamp{width:18px;height:18px;border-radius:50%;background:rgba(255,255,255,0.06);box-shadow:0 2px 8px rgba(0,0,0,0.6) inset}
    .lamp.on{background:var(--accent);box-shadow:0 0 10px rgba(255,222,0,0.9)}
    /* ÂΩì„Åü„Çä„Ç¢„Éã„É° */
    .flash{animation:flash 700ms ease-in-out 3}
    @keyframes flash{0%{transform:scale(1);filter:brightness(1)}50%{transform:scale(1.08);filter:brightness(1.7)}100%{transform:scale(1);filter:brightness(1)}}
    /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
    @media(max-width:640px){.reel{width:68px;height:68px}.reel.center{font-size:1.5rem}}
  </style>
</head>
<body>
  <div class="machine">
    <h1>„Ç¢„Ç§„É†„Ç∏„É£„Ç∞„É©„ÉºÈ¢®</h1>
    <div class="info">
  <div id="money">ÊâÄÊåÅÈáë: 5000ÂÜÜ</div>
      <div id="gogo">GOGO!</div>
    </div>

    <div class="reels" role="region" aria-label="„É™„Éº„É´">
      <div class="reel-stack">
        <div class="reel" id="reel1-0">7</div>
        <div class="reel center" id="reel1-1">7</div>
        <div class="reel" id="reel1-2">7</div>
        <button class="stop-btn" id="stop1" disabled>STOP</button>
      </div>
      <div class="reel-stack">
        <div class="reel" id="reel2-0">7</div>
        <div class="reel center" id="reel2-1">7</div>
        <div class="reel" id="reel2-2">7</div>
        <button class="stop-btn" id="stop2" disabled>STOP</button>
      </div>
      <div class="reel-stack">
        <div class="reel" id="reel3-0">7</div>
        <div class="reel center" id="reel3-1">7</div>
        <div class="reel" id="reel3-2">7</div>
        <button class="stop-btn" id="stop3" disabled>STOP</button>
      </div>
    </div>

    <div class="lamp-row" aria-hidden="true">
      <div class="lamp" id="lamp1"></div>
      <div class="lamp" id="lamp2"></div>
      <div class="lamp" id="lamp3"></div>
    </div>

    <div class="controls">
      <button id="start">„Çπ„Çø„Éº„Éà</button>
      <button id="auto" title="ÂÖ®Ëá™Âãï„ÅßÈ†ÜÁï™„Å´Ê≠¢„ÇÅ„Åæ„Åô">„Ç™„Éº„Éà</button>
  <button id="testMode" title="GOGOÁô∫ÁîüÁéá„ÇíÈ´ò„ÇÅ„Çã„ÉÜ„Çπ„Éà„É¢„Éº„Éâ">„ÉÜ„Çπ„Éà: OFF</button>
    </div>
  </div>

  <script>
  // ÁµµÊüÑ„É™„Çπ„Éà
  const symbols = ['7', 'BAR', 'üçí', 'üçá', 'üîî'];
  const symbolsNo7 = symbols.filter(s => s !== '7');
    // 3„É™„Éº„É´√ó3ÊÆµ
    const reels = [
      [document.getElementById('reel1-0'), document.getElementById('reel1-1'), document.getElementById('reel1-2')],
      [document.getElementById('reel2-0'), document.getElementById('reel2-1'), document.getElementById('reel2-2')],
      [document.getElementById('reel3-0'), document.getElementById('reel3-1'), document.getElementById('reel3-2')]
    ];
    const stops = [
      document.getElementById('stop1'),
      document.getElementById('stop2'),
      document.getElementById('stop3')
    ];
  const gogo = document.getElementById('gogo');
  const lamps = [document.getElementById('lamp1'), document.getElementById('lamp2'), document.getElementById('lamp3')];
    let intervals = [null, null, null];
    let stopped = [false, false, false];
  let gogoChance = false; // „Ç¥„Éº„Ç¥„Éº„ÉÅ„É£„É≥„Çπ‰∏≠„Éï„É©„Ç∞
  let gogoRemain = 0; // GOGOÁ∂ôÁ∂ö„ÅÆÊÆã„Çä„Ç≤„Éº„É†Êï∞
  let money = 5000;
    const moneyDiv = document.getElementById('money');
  const autoBtn = document.getElementById('auto');
  const testModeBtn = document.getElementById('testMode');
  let testModeEnabled = false;

    // ÂêÑ„É™„Éº„É´„ÅÆË°®Á§∫ÂÜÖÂÆπÔºà3ÊÆµÔºâ
    let reelSymbols = [
      ['7', '7', '7'],
      ['7', '7', '7'],
      ['7', '7', '7']
    ];

    function updateMoney() {
      moneyDiv.textContent = `ÊâÄÊåÅÈáë: ${money}ÂÜÜ`;
    }

    function updateGogoText(){
      if(gogoRemain > 0){
        gogo.textContent = `GOGO x${gogoRemain}`;
        gogo.style.display = 'block';
      } else if(gogoChance){
        gogo.textContent = 'GOGO CHANCE!';
        gogo.style.display = 'block';
      } else {
        gogo.style.display = 'none';
      }
    }

    // ÈÖçÂΩì„ÉÜ„Éº„Éñ„É´Ôºà„Éô„Éº„ÇπÔºâ
    const basePayout = {
      '7': 2000,
      'BAR': 200,
      'üçí': 100,
      'üîî': 150,
      'üçá': 500
    };

    // „É©„Ç§„É≥ÂÆöÁæ©Ôºàname, positions [reel,row], typeÔºâ
    const lines = [
      {name:'Ê®™‰∏ä', pos:[[0,0],[1,0],[2,0]], type:'horizontal'},
      {name:'Ê®™‰∏≠', pos:[[0,1],[1,1],[2,1]], type:'horizontal'},
      {name:'Ê®™‰∏ã', pos:[[0,2],[1,2],[2,2]], type:'horizontal'},
      {name:'Á∏¶Â∑¶', pos:[[0,0],[0,1],[0,2]], type:'vertical'},
      {name:'Á∏¶‰∏≠', pos:[[1,0],[1,1],[1,2]], type:'vertical'},
      {name:'Á∏¶Âè≥', pos:[[2,0],[2,1],[2,2]], type:'vertical'},
      {name:'Êñú„ÇÅTLBR', pos:[[0,0],[1,1],[2,2]], type:'diagonal'},
      {name:'Êñú„ÇÅBLTR', pos:[[0,2],[1,1],[2,0]], type:'diagonal'}
    ];

    const typeMultiplier = { horizontal:1.0, vertical:1.2, diagonal:1.1 };

    // „É©„Ç§„É≥„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶ÈÖçÂΩì„ÇíËøî„Åô
    function evaluateLines(){
      const hits = [];
      let total = 0;
      for(const L of lines){
        const syms = L.pos.map(p => reelSymbols[p[0]][p[1]]);
        const allSame = syms.every(s => s === syms[0]);
        if(allSame){
          const sym = syms[0];
          const base = basePayout[sym] || 0;
          if(base > 0){
            const payout = Math.round(base * (typeMultiplier[L.type] || 1));
            total += payout;
            hits.push({line: L.name, positions: L.pos, symbol: sym, payout});
          }
        }
      }
      return { total, hits };
    }

    // Âº∑Ë™øË°®Á§∫: Ë©≤ÂΩì„Åô„Çã„Çª„É´„Å´„Éï„É©„ÉÉ„Ç∑„É•„Çí‰ªò„Åë„Çã
    function highlightPositions(positions){
      positions.forEach(p => {
        const el = reels[p[0]][p[1]];
        if(el) el.classList.add('flash');
      });
      setTimeout(()=>{
        positions.forEach(p => {
          const el = reels[p[0]][p[1]];
          if(el) el.classList.remove('flash');
        });
      }, 1600);
    }

    function startReel(idx) {
      intervals[idx] = setInterval(() => {
        // 3„Å§„ÅÆÁµµÊüÑ„Çí„É©„É≥„ÉÄ„É†„Å´Ê±∫ÂÆö
        for (let j = 0; j < 3; j++) {
          // 7„ÅÆÂá∫ÁèæÁ¢∫Áéá„ÇíÂà∂Âæ°Ôºà‰∏≠Â§Æ„Å®Èùû‰∏≠Â§Æ„ÅßÂà•Á¢∫Áéá„ÄÅGOGO‰∏≠„ÅØ‰∏äÊòáÔºâ
          if (j === 1) {
            const centerChance = gogoChance ? 0.22 : 0.05; // ‰∏≠ÊÆµ„ÅÆ7Âá∫ÁèæÁ¢∫ÁéáÔºàÈÄöÂ∏∏5% / GOGO‰∏≠22%Ôºâ
            if (Math.random() < centerChance) {
              reelSymbols[idx][j] = '7';
            } else {
              // 7‰ª•Â§ñ„ÇíÈÅ∏„Å∂
              const rand = Math.floor(Math.random() * symbolsNo7.length);
              reelSymbols[idx][j] = symbolsNo7[rand];
            }
          } else {
            const sideChance = gogoChance ? 0.04 : 0.03; // ÂÅ¥ÊÆµ„ÅÆ7Âá∫ÁèæÁ¢∫ÁéáÔºàÈÄöÂ∏∏3% / GOGO‰∏≠4%Ôºâ
            if (Math.random() < sideChance) {
              reelSymbols[idx][j] = '7';
            } else {
              const rand = Math.floor(Math.random() * symbolsNo7.length);
              reelSymbols[idx][j] = symbolsNo7[rand];
            }
          }
          reels[idx][j].textContent = reelSymbols[idx][j];
        }
      }, 80 + idx * 30);
    }

    function highlightLamp(idx, on){
      if(lamps[idx]) lamps[idx].classList.toggle('on', !!on);
    }

    function stopReel(idx) {
      clearInterval(intervals[idx]);
      stopped[idx] = true;
      stops[idx].disabled = true;
      highlightLamp(idx, false);
      // ÂÖ®ÈÉ®Ê≠¢„Åæ„Å£„Åü„ÇâÂà§ÂÆö
      if (stopped.every(s => s)) {
        // „É©„Ç§„É≥Ë©ï‰æ°ÔºàÊ®™„ÉªÁ∏¶„ÉªÊñú„ÇÅÔºâ
        const evalRes = evaluateLines();
        if(evalRes.hits.length > 0){
          // ÂêÑ„Éí„ÉÉ„Éà„ÇíÂº∑Ë™ø„Åó„Å¶ÂêàË®àÈÖçÂΩì„ÇíÂä†ÁÆó
          evalRes.hits.forEach(h => highlightPositions(h.positions));
          money += evalRes.total;
          // ÈÖçÂΩì„ÅåÂá∫„ÅüÂ†¥Âêà GOGO Ë°®Á§∫„Çí‰∏ÄÊôÇÁöÑ„Å´Ë°®Á§∫
          gogo.textContent = `WIN +${evalRes.total}`;
          gogo.style.display = 'block';
        } else {
          if (!gogoChance && gogoRemain === 0) gogo.style.display = 'none';
        }
        updateMoney();
        document.getElementById('start').disabled = false;
        // „Çπ„Éî„É≥„ÅåÁµÇ„Çè„Å£„Åü„ÇâÁ∂ôÁ∂ö„Ç´„Ç¶„É≥„Éà„ÇíÊ∂àË≤ªÔºàÁ∂ôÁ∂ö‰∏≠„ÅÆ„ÅøÔºâ
        if(gogoRemain > 0){
          gogoRemain = Math.max(0, gogoRemain - 1);
        }
        // 1Âõû„ÅÆ„Åø„ÅÆ„Ç¥„Éº„Ç¥„Éº„ÉÅ„É£„É≥„Çπ„ÅØÁô∫ÂãïÂæå„Å´„É™„Çª„ÉÉ„Éà
        if(gogoChance) gogoChance = false;
        // „É©„É≥„Éó„ÅØÁ∂ôÁ∂ö„ÅåÁÑ°„Åë„Çå„Å∞Ê∂à„Åô
        if(gogoRemain === 0) lamps.forEach(l=>l.classList.remove('on'));
        updateGogoText();
      }
    }

    document.getElementById('start').onclick = function() {
      if (money < 100) {
        alert('ÊâÄÊåÅÈáë„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ');
        return;
      }
  // „Çπ„Éî„É≥ÈñãÂßãÊôÇ„Å´„Ç¥„Éº„Ç¥„Éº„ÉÅ„É£„É≥„ÇπÁô∫ÁîüÁ¢∫Áéá„ÇíÂ∏∏ÊôÇ1%„Å´Âõ∫ÂÆö
  gogoChance = Math.random() < 0.01;
      if (gogoChance) {
        // Á∂ôÁ∂ö„Ç≤„Éº„É†Êï∞„Çí„É©„É≥„ÉÄ„É†„Åß‰ªò‰∏éÔºà‰æã: 1„Äú3„Ç≤„Éº„É†Ôºâ
        gogoRemain = Math.floor(Math.random() * 3) + 1;
        lamps.forEach(l=>l.classList.add('on'));
      } else {
        // Á∂ôÁ∂ö„Å™„Åó
        gogoRemain = 0;
      }
      updateGogoText();

      money -= 100;
      updateMoney();
      stopped = [false, false, false];
      for (let i = 0; i < 3; i++) {
        startReel(i);
        stops[i].disabled = false;
        highlightLamp(i, true);
      }
      this.disabled = true;
    };

    stops.forEach((btn, idx) => {
      btn.onclick = function() {
        stopReel(idx);
      };
    });

    // „Ç™„Éº„Éà„Éú„Çø„É≥: È†Ü„Å´Ëá™ÂãïÂÅúÊ≠¢
    autoBtn.onclick = function(){
      if(document.getElementById('start').disabled) return; // Êó¢„Å´Âõû„Å£„Å¶„ÅÑ„Çã
      document.getElementById('start').click();
      // „É™„Éº„É´„ÇíÈ†Ü„Å´Ê≠¢„ÇÅ„ÇãÔºàÁü≠„ÇÅ„ÅÆÈñìÈöîÔºâ
      setTimeout(()=>stops[0].click(), 600);
      setTimeout(()=>stops[1].click(), 1150);
      setTimeout(()=>stops[2].click(), 1750);
    }

    // „ÉÜ„Çπ„Éà„É¢„Éº„ÉâÂàáÊõø
    testModeBtn.onclick = function(){
      testModeEnabled = !testModeEnabled;
      testModeBtn.textContent = testModeEnabled ? '„ÉÜ„Çπ„Éà: ON' : '„ÉÜ„Çπ„Éà: OFF';
      testModeBtn.style.background = testModeEnabled ? '#2e7d32' : '';
    }

    // ÂàùÊúüË°®Á§∫
    for (let i = 0; i < 3; i++) {
      for (let j = 0; j < 3; j++) {
        reels[i][j].textContent = reelSymbols[i][j];
      }
    }
    updateMoney();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¢ã‚¤ãƒ ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼é¢¨ã‚¹ãƒ­ãƒƒãƒˆ</title>
  <style>
    :root{--bg:#0b0b0f;--panel:#1e1b29;--accent:#ffde00;--muted:#666}
    body { font-family: 'Yu Gothic', system-ui, sans-serif; text-align: center; background: radial-gradient(ellipse at top, #0b0b0f 0%, #070607 60%), #000; color: #fff; min-height:100vh; margin:0; padding:24px; }
    h1{margin:0 0 8px 0; font-size:28px; letter-spacing:1px}
    .machine{max-width:740px;margin:18px auto;padding:18px;background:linear-gradient(180deg,#0f0f13, #141218);border-radius:12px;border:2px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    .info{display:flex;justify-content:space-between;align-items:center;padding:6px 12px}
    #money{font-weight:700;color:var(--accent)}
    .reels { display: flex; justify-content: center; gap:20px; margin: 18px 0; }
    .reel-stack { display: flex; flex-direction: column; align-items: center; background:linear-gradient(180deg,#151217,#0f0d12);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .reel { font-size:1.6rem; width:92px; height:92px; background:#0b0b0f; margin:4px 0; border-radius:8px; display:flex;align-items:center;justify-content:center;border:3px solid #221f2b;color:#fff;box-shadow:0 4px 18px rgba(0,0,0,0.6) inset}
    .reel.center{font-size:2rem;border-color:var(--accent);color:var(--accent);box-shadow:0 0 18px rgba(255,222,0,0.12), 0 4px 30px rgba(0,0,0,0.8) inset}
    .stop-btn { margin-top: 10px; font-size: 0.95rem; padding: 8px 18px; border-radius: 20px; border: none; background:#333;color:#fff;cursor:pointer}
    .stop-btn:disabled{opacity:0.35;cursor:default}
    .controls{display:flex;gap:12px;justify-content:center;align-items:center;margin-top:8px}
    #gogo{font-size:2.2rem;color:var(--accent);text-shadow:0 0 8px rgba(255,222,0,0.6);display:none}
    #start{font-size:1.05rem;padding:10px 26px;border-radius:24px;border:none;background:linear-gradient(180deg,#ff6b6b,#d9456b);color:#fff;cursor:pointer}
    #start:disabled{opacity:0.5}
    /* ãƒ©ãƒ³ãƒ— */
    .lamp-row{display:flex;gap:8px;justify-content:center;margin-top:8px}
    .lamp{width:18px;height:18px;border-radius:50%;background:rgba(255,255,255,0.06);box-shadow:0 2px 8px rgba(0,0,0,0.6) inset}
    .lamp.on{background:var(--accent);box-shadow:0 0 10px rgba(255,222,0,0.9)}
    /* å½“ãŸã‚Šã‚¢ãƒ‹ãƒ¡ */
    .flash{animation:flash 700ms ease-in-out 3}
    @keyframes flash{0%{transform:scale(1);filter:brightness(1)}50%{transform:scale(1.08);filter:brightness(1.7)}100%{transform:scale(1);filter:brightness(1)}}
    /* GOGO è¡¨ç¤ºç”¨ã‚¢ãƒ‹ãƒ¡ */
    #gogo.effect {
      animation: gogoPulse 900ms ease-in-out 3, gogoGlow 1200ms linear infinite;
      transform-origin: center;
      text-shadow: 0 0 18px rgba(255,222,0,0.95), 0 0 36px rgba(255,120,0,0.6);
      color: #fff;
    }
    @keyframes gogoPulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.25);opacity:0.95}100%{transform:scale(1);opacity:1}}
    @keyframes gogoGlow{0%{filter:drop-shadow(0 0 8px rgba(255,200,0,0.6))}50%{filter:drop-shadow(0 0 20px rgba(255,100,0,0.9))}100%{filter:drop-shadow(0 0 8px rgba(255,200,0,0.6))}}
    /* ãƒã‚·ãƒ³ç™ºå…‰ */
    .machine.glow{box-shadow:0 8px 60px rgba(255,180,0,0.15), 0 0 60px rgba(255,120,0,0.08) inset}
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media(max-width:640px){.reel{width:68px;height:68px}.reel.center{font-size:1.5rem}}
  </style>
</head>
<body>
  <div class="machine">
    <h1>ã‚¢ã‚¤ãƒ ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼é¢¨</h1>
    <div class="info">
  <div id="money">æ‰€æŒé‡‘: 5000å††</div>
      <div id="gogo">GOGO!</div>
    </div>

    <div class="reels" role="region" aria-label="ãƒªãƒ¼ãƒ«">
      <div class="reel-stack">
        <div class="reel" id="reel1-0">7</div>
        <div class="reel center" id="reel1-1">7</div>
        <div class="reel" id="reel1-2">7</div>
        <button class="stop-btn" id="stop1" disabled>STOP</button>
      </div>
      <div class="reel-stack">
        <div class="reel" id="reel2-0">7</div>
        <div class="reel center" id="reel2-1">7</div>
        <div class="reel" id="reel2-2">7</div>
        <button class="stop-btn" id="stop2" disabled>STOP</button>
      </div>
      <div class="reel-stack">
        <div class="reel" id="reel3-0">7</div>
        <div class="reel center" id="reel3-1">7</div>
        <div class="reel" id="reel3-2">7</div>
        <button class="stop-btn" id="stop3" disabled>STOP</button>
      </div>
    </div>

    <div class="lamp-row" aria-hidden="true">
      <div class="lamp" id="lamp1"></div>
      <div class="lamp" id="lamp2"></div>
      <div class="lamp" id="lamp3"></div>
    </div>

    <div class="controls">
      <button id="start">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button id="auto" title="å…¨è‡ªå‹•ã§é †ç•ªã«æ­¢ã‚ã¾ã™">ã‚ªãƒ¼ãƒˆ</button>
  <button id="testMode" title="GOGOç™ºç”Ÿç‡ã‚’é«˜ã‚ã‚‹ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰">ãƒ†ã‚¹ãƒˆ: OFF</button>
    </div>
  </div>

  <script>
  // çµµæŸ„ãƒªã‚¹ãƒˆ
  const symbols = ['7', 'BAR', 'ğŸ’', 'ğŸ‡', 'ğŸ””'];
  const symbolsNo7 = symbols.filter(s => s !== '7');
    // 3ãƒªãƒ¼ãƒ«Ã—3æ®µ
    const reels = [
      [document.getElementById('reel1-0'), document.getElementById('reel1-1'), document.getElementById('reel1-2')],
      [document.getElementById('reel2-0'), document.getElementById('reel2-1'), document.getElementById('reel2-2')],
      [document.getElementById('reel3-0'), document.getElementById('reel3-1'), document.getElementById('reel3-2')]
    ];
    const stops = [
      document.getElementById('stop1'),
      document.getElementById('stop2'),
      document.getElementById('stop3')
    ];
  const gogo = document.getElementById('gogo');
  const lamps = [document.getElementById('lamp1'), document.getElementById('lamp2'), document.getElementById('lamp3')];
    let intervals = [null, null, null];
    let stopped = [false, false, false];
  let gogoChance = false; // ã‚´ãƒ¼ã‚´ãƒ¼ãƒãƒ£ãƒ³ã‚¹ä¸­ãƒ•ãƒ©ã‚°
  let gogoRemain = 0; // GOGOç¶™ç¶šã®æ®‹ã‚Šã‚²ãƒ¼ãƒ æ•°
  let gogoPersist = false; // GOGOç™ºå‹•å¾Œã€BARã¾ãŸã¯7ãŒæƒã†ã¾ã§ç¶™ç¶šã™ã‚‹ãƒ¢ãƒ¼ãƒ‰
  let money = 5000;
    const moneyDiv = document.getElementById('money');
  const autoBtn = document.getElementById('auto');
  const testModeBtn = document.getElementById('testMode');
  let testModeEnabled = false;

    // å„ãƒªãƒ¼ãƒ«ã®è¡¨ç¤ºå†…å®¹ï¼ˆ3æ®µï¼‰
    let reelSymbols = [
      ['7', '7', '7'],
      ['7', '7', '7'],
      ['7', '7', '7']
    ];

    function updateMoney() {
      moneyDiv.textContent = `æ‰€æŒé‡‘: ${money}å††`;
    }

    function updateGogoText(){
  if(gogoRemain > 0){
        gogo.textContent = `GOGO x${gogoRemain}`;
        gogo.style.display = 'block';
  } else if(gogoChance || gogoPersist){
        gogo.textContent = 'GOGO CHANCE!';
        gogo.style.display = 'block';
      } else {
        gogo.style.display = 'none';
      }
    }

    // é…å½“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ™ãƒ¼ã‚¹ï¼‰
    const basePayout = {
      '7': 2000,
      'BAR': 200,
      'ğŸ’': 100,
      'ğŸ””': 150,
      'ğŸ‡': 500
    };

    // ãƒ©ã‚¤ãƒ³å®šç¾©ï¼ˆname, positions [reel,row], typeï¼‰
    const lines = [
      {name:'æ¨ªä¸Š', pos:[[0,0],[1,0],[2,0]], type:'horizontal'},
      {name:'æ¨ªä¸­', pos:[[0,1],[1,1],[2,1]], type:'horizontal'},
      {name:'æ¨ªä¸‹', pos:[[0,2],[1,2],[2,2]], type:'horizontal'},
      {name:'ç¸¦å·¦', pos:[[0,0],[0,1],[0,2]], type:'vertical'},
      {name:'ç¸¦ä¸­', pos:[[1,0],[1,1],[1,2]], type:'vertical'},
      {name:'ç¸¦å³', pos:[[2,0],[2,1],[2,2]], type:'vertical'},
      {name:'æ–œã‚TLBR', pos:[[0,0],[1,1],[2,2]], type:'diagonal'},
      {name:'æ–œã‚BLTR', pos:[[0,2],[1,1],[2,0]], type:'diagonal'}
    ];

    const typeMultiplier = { horizontal:1.0, vertical:1.2, diagonal:1.1 };

    // ãƒ©ã‚¤ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦é…å½“ã‚’è¿”ã™
    function evaluateLines(){
      const hits = [];
      let total = 0;
      for(const L of lines){
        const syms = L.pos.map(p => reelSymbols[p[0]][p[1]]);
        const allSame = syms.every(s => s === syms[0]);
        if(allSame){
          const sym = syms[0];
          const base = basePayout[sym] || 0;
          if(base > 0){
            const payout = Math.round(base * (typeMultiplier[L.type] || 1));
            total += payout;
            hits.push({line: L.name, positions: L.pos, symbol: sym, payout});
          }
        }
      }
      return { total, hits };
    }

    // å¼·èª¿è¡¨ç¤º: è©²å½“ã™ã‚‹ã‚»ãƒ«ã«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚’ä»˜ã‘ã‚‹
    function highlightPositions(positions){
      positions.forEach(p => {
        const el = reels[p[0]][p[1]];
        if(el) el.classList.add('flash');
      });
      setTimeout(()=>{
        positions.forEach(p => {
          const el = reels[p[0]][p[1]];
          if(el) el.classList.remove('flash');
        });
      }, 1600);
    }

    function startReel(idx) {
      intervals[idx] = setInterval(() => {
        // 3ã¤ã®çµµæŸ„ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®š
        for (let j = 0; j < 3; j++) {
          // 7ã®å‡ºç¾ç¢ºç‡ã‚’åˆ¶å¾¡ï¼ˆä¸­å¤®ã¨éä¸­å¤®ã§åˆ¥ç¢ºç‡ã€GOGOä¸­ã¯ä¸Šæ˜‡ï¼‰
          if (j === 1) {
            const centerChance = gogoChance ? 0.22 : 0.05; // ä¸­æ®µã®7å‡ºç¾ç¢ºç‡ï¼ˆé€šå¸¸5% / GOGOä¸­22%ï¼‰
            if (Math.random() < centerChance) {
              reelSymbols[idx][j] = '7';
            } else {
              // 7ä»¥å¤–ã‚’é¸ã¶
              const rand = Math.floor(Math.random() * symbolsNo7.length);
              reelSymbols[idx][j] = symbolsNo7[rand];
            }
          } else {
            const sideChance = gogoChance ? 0.04 : 0.03; // å´æ®µã®7å‡ºç¾ç¢ºç‡ï¼ˆé€šå¸¸3% / GOGOä¸­4%ï¼‰
            if (Math.random() < sideChance) {
              reelSymbols[idx][j] = '7';
            } else {
              const rand = Math.floor(Math.random() * symbolsNo7.length);
              reelSymbols[idx][j] = symbolsNo7[rand];
            }
          }
          reels[idx][j].textContent = reelSymbols[idx][j];
        }
      }, 80 + idx * 30);
    }

    // GOGO æ¼”å‡ºã‚’é–‹å§‹
    function gogoStartEffect(){
      const machine = document.querySelector('.machine');
      machine.classList.add('glow');
      gogo.classList.add('effect');
      // ãƒ©ãƒ³ãƒ—ã‚’æ´¾æ‰‹ã«ç‚¹æ»…ã•ã›ã‚‹
      let flashCount = 0;
      lamps.forEach((l, i) => {
        l._flashInterval = setInterval(()=>{
          l.classList.toggle('on');
          flashCount++;
          if(flashCount > 12){ // 12å›ã»ã©ç‚¹æ»…
            clearInterval(l._flashInterval);
            l.classList.add('on');
          }
        }, 120 + i*30);
      });
      // å°ã•ãªè¿½åŠ åŠ¹æœ: å…¨ãƒªãƒ¼ãƒ«ã‚’ä¸€ç¬ã‚ºãƒ¼ãƒ 
      reels.flat().forEach(el => el.classList.add('flash'));
      setTimeout(()=> reels.flat().forEach(el => el.classList.remove('flash')), 1000);
    }

    // GOGO æ¼”å‡ºã‚’çµ‚äº†
    function gogoEndEffect(){
      const machine = document.querySelector('.machine');
      machine.classList.remove('glow');
      gogo.classList.remove('effect');
      lamps.forEach(l=>{
        if(l._flashInterval) { clearInterval(l._flashInterval); l._flashInterval = null; }
        l.classList.remove('on');
      });
    }

    function highlightLamp(idx, on){
      if(lamps[idx]) lamps[idx].classList.toggle('on', !!on);
    }

    function stopReel(idx) {
      clearInterval(intervals[idx]);
      stopped[idx] = true;
      stops[idx].disabled = true;
      highlightLamp(idx, false);
      // å…¨éƒ¨æ­¢ã¾ã£ãŸã‚‰åˆ¤å®š
      if (stopped.every(s => s)) {
        // ãƒ©ã‚¤ãƒ³è©•ä¾¡ï¼ˆæ¨ªãƒ»ç¸¦ãƒ»æ–œã‚ï¼‰
        const evalRes = evaluateLines();
        if(evalRes.hits.length > 0){
          // å„ãƒ’ãƒƒãƒˆã‚’å¼·èª¿ã—ã¦åˆè¨ˆé…å½“ã‚’åŠ ç®—
          evalRes.hits.forEach(h => highlightPositions(h.positions));
          money += evalRes.total;
          // é…å½“ãŒå‡ºãŸå ´åˆ GOGO è¡¨ç¤ºã‚’ä¸€æ™‚çš„ã«è¡¨ç¤º
          gogo.textContent = `WIN +${evalRes.total}`;
          gogo.style.display = 'block';
        } else {
          if (!gogoChance && !gogoPersist && gogoRemain === 0) gogo.style.display = 'none';
        }
        updateMoney();
        document.getElementById('start').disabled = false;
        // GOGO ç™ºå‹•å¾Œã®ç¶™ç¶šãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ãªã‚‰ã€BARã¾ãŸã¯7ãŒæƒã£ãŸã‹ã§çµ‚äº†åˆ¤å®š
        if(gogoPersist){
          const endOnHit = evalRes.hits.some(h => h.symbol === '7' || h.symbol === 'BAR');
          if(endOnHit){
            // çµ‚äº†: è¡¨ç¤ºã¨ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
            gogoPersist = false;
            gogoChance = false;
            lamps.forEach(l=>l.classList.remove('on'));
            gogoEndEffect();
          } else {
            // ç¶™ç¶šä¸­ã¯ GOGO åŠ¹æœã‚’ç¶­æŒï¼ˆ7 ã®å‡ºç¾ç¢ºç‡ãŒä¸ŠãŒã‚‹ï¼‰
            gogoChance = true;
          }
        } else {
          // æ—¢å­˜ã®ç¶™ç¶šã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†ï¼ˆäº’æ›ï¼‰
          if(gogoRemain > 0){
            gogoRemain = Math.max(0, gogoRemain - 1);
          }
          // 1å›ã®ã¿ã®ã‚´ãƒ¼ã‚´ãƒ¼ãƒãƒ£ãƒ³ã‚¹ã¯ç™ºå‹•å¾Œã«ãƒªã‚»ãƒƒãƒˆ
          if(gogoChance) gogoChance = false;
          // ãƒ©ãƒ³ãƒ—ã¯ç¶™ç¶šãŒç„¡ã‘ã‚Œã°æ¶ˆã™
          if(gogoRemain === 0) lamps.forEach(l=>l.classList.remove('on'));
          if(gogoRemain === 0) gogoEndEffect();
        }
        updateGogoText();
      }
    }

    document.getElementById('start').onclick = function() {
      if (money < 100) {
        alert('æ‰€æŒé‡‘ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
        return;
      }
  // æ—¢ã« persist ãƒ¢ãƒ¼ãƒ‰ä¸­ãªã‚‰ãã®ã¾ã¾ GOGO ã‚’ç¶™ç¶šï¼ˆæ¬¡ã‚¹ãƒ”ãƒ³ã§ã‚‚æœ‰åŠ¹ï¼‰
  if (gogoPersist) {
    gogoChance = true;
    // lamps ã¯æ—¢ã«ç‚¹ç¯ã—ã¦ã„ã‚‹ã¯ãšã ãŒå¿µã®ãŸã‚ã‚ªãƒ³ã«ã™ã‚‹
    lamps.forEach(l=>l.classList.add('on'));
  gogoStartEffect();
  } else {
    // ã‚¹ãƒ”ãƒ³é–‹å§‹æ™‚ã«ã‚´ãƒ¼ã‚´ãƒ¼ãƒãƒ£ãƒ³ã‚¹ç™ºç”Ÿç¢ºç‡ã‚’è¨­å®šï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰æ™‚ã¯é«˜ç¢ºç‡ï¼‰
    const baseGogoProb = testModeEnabled ? 0.5 : 0.01; // ãƒ†ã‚¹ãƒˆ:50% / é€šå¸¸:1%
    gogoChance = Math.random() < baseGogoProb;
    if (gogoChance) {
      // ç™ºå‹•æ™‚ã¯BARã¾ãŸã¯7ãŒæƒã†ã¾ã§ç¶™ç¶šã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹
      gogoPersist = true;
      gogoRemain = 0;
      lamps.forEach(l=>l.classList.add('on'));
      gogoStartEffect();
    } else {
      // ç¶™ç¶šãªã—
      gogoPersist = false;
      gogoRemain = 0;
    }
  }
      updateGogoText();

      money -= 100;
      updateMoney();
      stopped = [false, false, false];
      for (let i = 0; i < 3; i++) {
        startReel(i);
        stops[i].disabled = false;
        highlightLamp(i, true);
      }
      this.disabled = true;
    };

    stops.forEach((btn, idx) => {
      btn.onclick = function() {
        stopReel(idx);
      };
    });

    // ã‚ªãƒ¼ãƒˆãƒœã‚¿ãƒ³: é †ã«è‡ªå‹•åœæ­¢
    autoBtn.onclick = function(){
      if(document.getElementById('start').disabled) return; // æ—¢ã«å›ã£ã¦ã„ã‚‹
      document.getElementById('start').click();
      // ãƒªãƒ¼ãƒ«ã‚’é †ã«æ­¢ã‚ã‚‹ï¼ˆçŸ­ã‚ã®é–“éš”ï¼‰
      setTimeout(()=>stops[0].click(), 600);
      setTimeout(()=>stops[1].click(), 1150);
      setTimeout(()=>stops[2].click(), 1750);
    }

    // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
    testModeBtn.onclick = function(){
      testModeEnabled = !testModeEnabled;
      testModeBtn.textContent = testModeEnabled ? 'ãƒ†ã‚¹ãƒˆ: ON' : 'ãƒ†ã‚¹ãƒˆ: OFF';
      testModeBtn.style.background = testModeEnabled ? '#2e7d32' : '';
    }

    // åˆæœŸè¡¨ç¤º
    for (let i = 0; i < 3; i++) {
      for (let j = 0; j < 3; j++) {
        reels[i][j].textContent = reelSymbols[i][j];
      }
    }
    updateMoney();
  </script>
</body>
</html>
